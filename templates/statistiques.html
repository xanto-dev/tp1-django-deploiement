{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Statistiques</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-5">

  <h1 class="text-center mb-5">ğŸ“Š Tableau de bord des statistiques</h1>

  <!-- ğŸ”— MENU DE NAVIGATION -->
  <nav class="mb-5">
    <div class="card shadow-sm">
      <div class="card-body">
        <h4 class="text-center mb-3">Sommaire</h4>
        <div class="d-flex justify-content-around flex-wrap">
          <div>
            <h5 class="text-primary">Environnement, ressources naturelles et Ã©nergie</h5>
            <ul class="list-unstyled">
              <li><a href="#animaux" class="text-decoration-none">ğŸ¶ Permis dâ€™animaux</a></li>
              <li><a href="#ges" class="text-decoration-none">ğŸŒ Registre des Ã©missions de GES</a></li>
            </ul>
          </div>
          <div>
            <h5 class="text-success">Infrastructures</h5>
            <ul class="list-unstyled">
              <li><a href="#construction" class="text-decoration-none">ğŸ—ï¸ Permis de construction</a></li>
              <li><a href="#aqueduc" class="text-decoration-none">ğŸš° Bon de travail aqueduc</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- ğŸŸ¦ Permis dâ€™animaux -->
  <section id="animaux" class="mb-5">
    <div class="card text-center shadow-sm mb-4">
      <div class="card-body">
        <h4 class="card-title text-primary">ğŸ¶ Permis dâ€™animaux</h4>
        <h2>{{ total_animaux }}</h2>
      </div>
    </div>

    <h5 class="mt-4">RÃ©partition des types de permis</h5>
    <table class="table table-striped table-hover mt-3">
      <thead class="table-dark">
        <tr>
          <th>Type de permis</th>
          <th>Nombre</th>
        </tr>
      </thead>
      <tbody>
        {% for item in repartition_types_animaux %}
        <tr>
          <td>{{ item.animal_type_permis|default:"Non spÃ©cifiÃ©" }}</td>
          <td>{{ item.nombre }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="2" class="text-center">Aucune donnÃ©e</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

  <!-- ğŸŒ Registre des Ã©missions GES -->
  <section id="ges" class="mt-5">
    <div class="card text-center shadow-sm mb-4">
      <div class="card-body">
        <h4 class="card-title text-danger">ğŸŒ Registre des Ã©missions de GES</h4>
        <h2>{{ total_ges }}</h2>
      </div>
    </div>

    <h5 class="mt-4">RÃ©partition par rÃ©gion</h5>
    <table class="table table-striped table-hover mt-3">
      <thead class="table-dark">
        <tr>
          <th>RÃ©gion</th>
          <th>Nombre dâ€™Ã©tablissements</th>
        </tr>
      </thead>
      <tbody>
        {% for r in repartition_region_ges %}
        <tr>
          <td>{{ r.region|default:"Non spÃ©cifiÃ©e" }}</td>
          <td>{{ r.nombre }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="2" class="text-center">Aucune donnÃ©e</td></tr>
        {% endfor %}
      </tbody>
    </table>

    <h5 class="mt-4">Ã‰volution des Ã©missions totales (t COâ‚‚ eq.)</h5>
    <table class="table table-bordered mt-3">
      <thead class="table-secondary">
        <tr>
          <th>AnnÃ©e</th>
          <th>Ã‰missions totales</th>
        </tr>
      </thead>
      <tbody>
        {% for g in tendances_ges %}
        <tr>
          <td>{{ g.annee }}</td>
          <td>{{ g.emissions_totales|floatformat:0 }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="2" class="text-center">Aucune donnÃ©e</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

  <!-- ğŸ—ï¸ Permis de construction -->
  <section id="construction" class="mt-5">
    <div class="card text-center shadow-sm mb-4">
      <div class="card-body">
        <h4 class="card-title text-success">ğŸ—ï¸ Permis de construction</h4>
        <h2>{{ total_construction }}</h2>
      </div>
    </div>

    <h5 class="mt-4">Tendances par annÃ©e</h5>
    <table class="table table-bordered mt-3">
      <thead class="table-secondary">
        <tr>
          <th>AnnÃ©e</th>
          <th>Nombre de permis</th>
        </tr>
      </thead>
      <tbody>
        {% for t in tendances_construction %}
        <tr>
          <td>{{ t.annee|date:"Y" }}</td>
          <td>{{ t.total }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="2" class="text-center">Aucune donnÃ©e</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

  <!-- ğŸš° Bon de travail aqueduc -->
  <section id="aqueduc" class="mt-5">
    <div class="card text-center shadow-sm mb-4">
      <div class="card-body">
        <h4 class="card-title text-info">ğŸš° Bon de travail aqueduc</h4>
        <h2>{{ total_aqueduc }}</h2>
      </div>
    </div>

    <h5 class="mt-4">RÃ©partition par secteur</h5>
    <table class="table table-striped table-hover mt-3">
      <thead class="table-dark">
        <tr>
          <th>Secteur</th>
          <th>Nombre</th>
        </tr>
      </thead>
      <tbody>
        {% for s in repartition_secteur_aqueduc %}
        <tr>
          <td>{{ s.secteur|default:"Non spÃ©cifiÃ©" }}</td>
          <td>{{ s.nombre }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="2" class="text-center">Aucune donnÃ©e</td></tr>
        {% endfor %}
      </tbody>
    </table>

    <h5 class="mt-4">Tendances annuelles</h5>
    <table class="table table-bordered mt-3">
      <thead class="table-secondary">
        <tr>
          <th>AnnÃ©e</th>
          <th>Nombre dâ€™interventions</th>
        </tr>
      </thead>
      <tbody>
        {% for t in tendances_aqueduc %}
        <tr>
          <td>{{ t.annee|date:"Y" }}</td>
          <td>{{ t.total }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="2" class="text-center">Aucune donnÃ©e</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

</div>

</body>
</html>
